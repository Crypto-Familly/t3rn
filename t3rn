#!/bin/bash

# Кольори для виводу
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
NC='\033[0m' # Скидання кольору

# Вивід логотипу Crypto-Family
echo -e "${GREEN}"
echo "╭━━━╮╱╱╱╱╱╱╱╱╭╮╱╱╱╱╭━━━╮╱╱╱╱╱╱╭╮╭╮"
echo "┃╭━╮┃╱╱╱╱╱╱╱╭╯╰╮╱╱╱┃╭━━╯╱╱╱╱╱╱┃┃┃┃"
echo "┃┃╱╰╋━┳╮╱╭┳━┻╮╭╋━━╮┃╰━━┳━━┳╮╭┳┫┃┃┃╭╮╱╭╮"
echo "┃┃╱╭┫╭┫┃╱┃┃╭╮┃┃┃╭╮┃┃╭━━┫╭╮┃╰╯┣┫┃┃┃┃┃╱┃┃"
echo "┃╰━╯┃┃┃╰━╯┃╰╯┃╰┫╰╯┃┃┃╱╱┃╭╮┃┃┃┃┃╰┫╰┫╰━╯┃"
echo "╰━━━┻╯╰━╮╭┫╭━┻━┻━━╯╰╯╱╱╰╯╰┻┻┻┻┻━┻━┻━╮╭╯"
echo "╱╱╱╱╱╱╭━╯┃┃┃╱╱╱╱╱╱╱╱╱╱╱╱╱╱╱╱╱╱╱╱╱╱╭━╯┃"
echo "╱╱╱╱╱╱╰━━╯╰╯╱╱╱╱╱╱╱╱╱╱╱╱╱╱╱╱╱╱╱╱╱╱╰━━╯"
echo -e "${NC}"

# Оновлення системи та встановлення необхідних пакетів
sudo apt update && sudo apt upgrade -y
sudo apt install curl screen -y

# Встановлення figlet для ASCII-арту (опціонально)
sudo apt-get install figlet -y
figlet -f /usr/share/figlet/starwars.flf "Crypto-Family"

# Завантаження останньої версії executor
LATEST_VERSION=$(curl -s https://api.github.com/repos/t3rn/executor-release/releases/latest | grep 'tag_name' | cut -d\" -f4)
EXECUTOR_URL="https://github.com/t3rn/executor-release/releases/download/${LATEST_VERSION}/executor-linux-${LATEST_VERSION}.tar.gz"
curl -L -o executor-linux-${LATEST_VERSION}.tar.gz $EXECUTOR_URL

# Розпакування архіву
tar -xzvf executor-linux-${LATEST_VERSION}.tar.gz
rm -rf executor-linux-${LATEST_VERSION}.tar.gz
cd executor/executor/bin

# Створення сесії screen для запуску ноди
screen -S t3rn

# Налаштування змінних середовища
export NODE_ENV=testnet
export LOG_LEVEL=debug
export LOG_PRETTY=false
export EXECUTOR_PROCESS_ORDERS=true
export EXECUTOR_PROCESS_CLAIMS=true

# Запит приватного ключа у користувача
echo -e "${YELLOW}Введіть ваш приватний ключ EVM-гаманця:${NC}"
read PRIVATE_KEY
export PRIVATE_KEY_LOCAL=$PRIVATE_KEY

# Вказання мереж для використання
export ENABLED_NETWORKS='base-sepolia,arbitrum-sepolia,optimism-sepolia,l1rn'

# Запуск ноди
./executor

# Інструкція для виходу з сесії screen
echo -e "${CYAN}Натисніть CTRL+A, потім D для виходу з сесії screen.${NC}"

# Посилання на ресурси Crypto-Family
echo -e "${GREEN}Crypto-Family — вся крипта в одному місці!${NC}"
echo -e "${CYAN}Наш Telegram: https://t.me/Crypto_Familly_Activity${NC}"
echo -e "${CYAN}Наш GitHub: https://github.com/Crypto-Familly${NC}"
